<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="theme-color" content="#5b9279" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Cattle AI Monitor</title>
<!-- RemixIcon CDN -->
<link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<style>
  /* ---------- Mobile-first base styles with clean white theme ---------- */
  :root {
    /* Clean white theme with green accents */
    --bg-light: #ffffff;
    --bg-lighter: #f8f9fa;
    --card-bg: #ffffff;
    --accent: rgb(194, 122, 71);
    --accent-hover: rgb(154, 88, 40);
    --accent-light: rgb(194, 122, 71);
    --muted: #6c757d;
    --muted-darker: #495057;
    --text-primary: #212529;
    --text-secondary: #495057;
    --good: #28a745;
    --warn: #ffc107;
    --danger: #dc3545;
    --glass: rgba(0,0,0,0.04);
    --border: #e9ecef;
    --shadow: rgba(0, 0, 0, 0.08);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  }
  
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
  
  /* Clean white background */
  html, body {
    height: 100%;
    background: var(--bg-light);
    color: var(--text-primary);
    overflow-x: hidden;
  }
  
  /* Splash screen */
  #splash-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--bg-light);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    transition: opacity 0.5s ease;
  }
  
  .splash-logo {
    width: 80px;
    height: 80px;
    background-color: var(--accent);
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 24px;
    font-size: 2.5rem;
    color: white;
    box-shadow: 0 8px 24px var(--shadow);
  }
  
  .splash-text {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 8px;
    color: var(--text-primary);
  }
  
  .splash-subtext {
    color: var(--muted);
    font-size: 0.9rem;
  }
  
  /* Auth screens */
  #auth-screen {
    min-height: 100vh;
    padding: 40px 24px 20px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    max-width: 400px;
    margin: 0 auto;
  }
  
  .auth-header {
    text-align: center;
    margin-bottom: 32px;
  }
  
  
  .auth-logo {
    width: 64px;
    height: 64px;
    background: linear-gradient(135deg, var(--accent), var(--accent-light));
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 16px;
    font-size: 2rem;
    color: white;
  }
  
  .auth-title {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 8px;
    color: var(--text-primary);
  }
  
  .auth-subtitle {
    color: var(--muted);
    font-size: 0.9rem;
  }
  
  .auth-card {
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    box-shadow: 0 4px 16px var(--shadow);
    margin-bottom: 16px;
  }
  
  .form-group {
    margin-bottom: 20px;
  }
  
  .form-label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: var(--muted);
    font-size: 0.9rem;
  }
  
  .form-input {
    width: 100%;
    padding: 14px 16px;
    background: var(--bg-lighter);
    border: 1px solid var(--border);
    border-radius: 12px;
    color: var(--text-primary);
    font-size: 1rem;
    transition: all 0.2s ease;
  }
  
  .form-input:focus {
    outline: none;
    border-color: var(--accent);
    background: white;
    box-shadow: 0 0 0 3px rgba(91, 146, 121, 0.1);
  }
  
  .form-input.with-icon {
    padding-left: 44px;
  }
  
  .input-icon {
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--muted-darker);
    font-size: 1.1rem;
  }
  
  .input-wrapper {
    position: relative;
  }
  
  .auth-link {
    color: var(--accent);
    text-decoration: none;
    font-weight: 500;
    font-size: 0.9rem;
  }
  
  .auth-link:hover {
    text-decoration: underline;
  }
  
  /* Main app container - hidden by default */
  .app {
    max-width: 480px;
    margin: 0 auto;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .app-loaded {
    opacity: 1;
  }
  
  .app-header {
    padding: 16px 16px 0;
    background: var(--bg-light);
    position: sticky;
    top: 0;
    z-index: 10;
    border-bottom: 1px solid var(--border);
  }
  
  .app-header-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    margin-bottom: 16px;
  }
  
  h1 {
    font-size: 1.25rem;
    font-weight: 700;
    letter-spacing: -0.02em;
    color: var(--text-primary);
  }
  
  .header-actions {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .header-btn {
    background: transparent;
    border: none;
    color: var(--muted);
    font-size: 1.2rem;
    cursor: pointer;
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
  }
  
  .header-btn:hover {
    background: var(--bg-lighter);
    color: var(--accent);
  }
  
  .header-btn.logout {
    color: var(--danger);
  }
  
  .header-btn.logout:hover {
    background: rgba(220, 53, 69, 0.1);
  }
  
  /* Main content area */
  .app-main {
    flex: 1;
    padding: 16px 16px 20px;
  }
  
  /* Clean card design with subtle shadows */
  .card {
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 2px 8px var(--shadow);
    margin-bottom: 16px;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  
  .card:hover {
    box-shadow: 0 4px 12px var(--shadow);
  }
  
  /* Primary button with accent color */
  .big-btn {
    display: block;
    width: 100%;
    padding: 16px 20px;
    border-radius: 12px;
    background: var(--accent);
    border: 0;
    color: white;
    font-weight: 600;
    font-size: 1rem;
    margin: 10px 0;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
  }
  
  .big-btn:hover {
    background: var(--accent-hover);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(91, 146, 121, 0.25);
  }
  
  .big-btn:active {
    transform: translateY(0);
  }
  
  /* Scan button at the top */
  .scan-top-btn {
    background: linear-gradient(135deg, var(--accent), var(--accent-light));
    color: white;
    padding: 18px;
    margin-bottom: 20px;
    font-size: 1.05rem;
  }
  
  .scan-top-btn i {
    font-size: 1.3rem;
  }
  
  /* Enhanced stats cards */
  .stats {
    display: flex;
    gap: 10px;
    justify-content: space-between;
    margin-bottom: 20px;
  }
  
  .stat {
    flex: 1;
    padding: 16px 12px;
    border-radius: 12px;
    background: var(--bg-lighter);
    border: 1px solid var(--border);
    text-align: center;
    transition: all 0.2s ease;
  }
  
  .stat:hover {
    background: white;
    border-color: var(--accent-light);
  }
  
  /* Improved animal cards with hover effect */
  .animal-card {
    display: flex;
    gap: 12px;
    align-items: center;
    padding: 16px;
    border-radius: 12px;
    background: var(--bg-lighter);
    border: 1px solid var(--border);
    margin-bottom: 10px;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .animal-card:hover {
    background: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px var(--shadow);
    border-color: var(--accent-light);
  }
  
  /* Avatar design with icon background */
  .avatar {
    width: 56px;
    height: 56px;
    border-radius: 12px;
    background: linear-gradient(135deg, var(--accent), var(--accent-light));
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.5rem;
    flex-shrink: 0;
    color: white;
  }
  
  .avatar i {
    font-size: 2rem;
  }
  
  .muted {
    color: var(--muted);
    font-size: 0.875rem;
  }
  
  .status-healthy {
    color: var(--good);
    font-weight: 600;
  }
  
  .status-warn {
    color: var(--warn);
    font-weight: 600;
  }
  
  .status-critical {
    color: var(--danger);
    font-weight: 600;
  }
  
  /* Enhanced alert rows */
  .alert-row {
    display: flex;
    gap: 10px;
    align-items: center;
    padding: 14px;
    border-radius: 10px;
    background: var(--bg-lighter);
    border: 1px solid var(--border);
    margin-bottom: 8px;
    transition: all 0.2s ease;
  }
  
  .alert-row:hover {
    background: white;
    border-color: var(--accent-light);
  }
  
  .small {
    font-size: 0.8rem;
  }
  
  /* Footer navigation */
  .app-footer {
    padding: 12px 0;
    display: flex;
    gap: 8px;
    justify-content: space-around;
    position: sticky;
    bottom: 0;
    background: var(--bg-light);
    border-top: 1px solid var(--border);
    backdrop-filter: blur(10px);
  }
  
  .nav-btn {
    background: transparent;
    border: 0;
    color: var(--muted-darker);
    font-weight: 600;
    padding: 10px 12px;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 0.85rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
  }
  
  .nav-btn:hover {
    color: var(--accent);
    background: var(--bg-lighter);
  }
  
  .nav-btn.active {
    color: var(--accent);
    background: rgba(91, 146, 121, 0.1);
  }
  
  .nav-icon {
    font-size: 1.2rem;
  }
  
  .nav-label {
    font-size: 0.7rem;
  }
  
  /* Views */
  .view {
    display: none;
  }
  
  .view.active {
    display: block;
  }
  
  /* Modal design */
  .modal-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 30;
    padding: 16px;
  }
  
  .modal {
    width: 100%;
    max-width: 420px;
    border-radius: 16px;
    background: var(--card-bg);
    border: 1px solid var(--border);
    padding: 24px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
    animation: modalSlideIn 0.3s ease;
  }
  
  @keyframes modalSlideIn {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .center {
    text-align: center;
  }
  
  input[type=file] {
    display: none;
  }
  
  /* Better progress bar */
  .progress {
    height: 8px;
    background: var(--bg-lighter);
    border-radius: 999px;
    overflow: hidden;
    margin-top: 16px;
    margin-bottom: 8px;
  }
  
  .progress > i {
    display: block;
    height: 100%;
    width: 0;
    background: linear-gradient(90deg, var(--accent), var(--accent-light));
    transition: width 0.1s linear;
    border-radius: 999px;
  }
  
  /* Enhanced section headers */
  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
  }
  
  .section-title {
    font-weight: 700;
    font-size: 1.1rem;
    color: var(--text-primary);
  }
  
  /* Video styling in camera modal */
  #camera-video {
    border-radius: 12px;
    background: #000;
    width: 100%;
    max-height: 300px;
    object-fit: cover;
    margin-bottom: 16px;
  }
  
  /* Camera preview image */
  #camera-preview {
    border-radius: 12px;
    width: 100%;
    max-height: 300px;
    object-fit: cover;
    margin-bottom: 16px;
    display: none;
  }
  
  /* Simple utility classes */
  .mb8 {
    margin-bottom: 8px;
  }
  
  .mt8 {
    margin-top: 10px;
  }
  
  .text-xs {
    font-size: 0.75rem;
  }
  
  /* Ghost button */
  .btn-ghost {
    background: transparent;
    border: 1px solid var(--border);
    padding: 10px 16px;
    border-radius: 10px;
    color: var(--muted);
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 0.9rem;
    font-weight: 500;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }
  
  .btn-ghost:hover {
    background: var(--bg-lighter);
    border-color: var(--muted);
    color: var(--text-primary);
  }
  
  .divider {
    height: 1px;
    background: var(--border);
    margin: 20px 0;
    position: relative;
  }
  
  .divider-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--card-bg);
    padding: 0 12px;
    color: var(--muted);
    font-size: 0.8rem;
  }
  
  /* Profile page styles */
  .profile-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }
  
  .profile-stats {
    display: flex;
    gap: 16px;
    justify-content: space-between;
    padding: 20px 0;
    border-top: 1px solid var(--border);
    border-bottom: 1px solid var(--border);
    margin: 20px 0;
  }
  
  /* Profile screen specific styles */
  .profile-section {
    padding: 16px;
    border-bottom: 1px solid var(--border);
  }
  
  .profile-section:last-child {
    border-bottom: none;
  }
  
  .profile-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
  }
  
  .profile-label {
    color: var(--muted);
    font-weight: 500;
  }
  
  .profile-value {
    font-weight: 600;
  }
  
  .profile-avatar-large {
    width: 80px;
    height: 80px;
    border-radius: 20px;
    background: linear-gradient(135deg, var(--accent), var(--accent-light));
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 16px;
    font-size: 2.5rem;
    color: white;
  }
  
  .danger-zone {
    background: rgba(220, 53, 69, 0.05);
    border: 1px solid rgba(220, 53, 69, 0.2);
    border-radius: 12px;
    padding: 20px;
    margin-top: 20px;
  }
  
  .info-note {
    background: rgba(91, 146, 121, 0.1);
    border-radius: 10px;
    padding: 16px;
    margin: 16px 0;
    border-left: 4px solid var(--accent);
    font-size: 0.9rem;
  }
  
  /* Desktop tweaks */
  @media(min-width: 800px) {
    .app {
      max-width: 500px;
    }
    
    .app-header {
      padding: 20px 24px 0;
    }
    
    .app-main {
      padding: 20px 24px 20px;
    }
    
    h1 {
      font-size: 1.5rem;
    }
    
    .card {
      padding: 24px;
    }
  }
  
  /* Hide elements utility */
  .hidden {
    display: none !important;
  }
  
  /* Camera action buttons */
  .camera-actions {
    display: flex;
    gap: 12px;
    margin-top: 20px;
  }
  
  .camera-actions .btn-ghost {
    flex: 1;
  }
  
  .camera-actions .big-btn {
    flex: 2;
    margin: 0;
  }
  
  /* Loading indicator */
  .loading {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 2px solid var(--border);
    border-top: 2px solid var(--accent);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  /* Scan Results Modal Styles */
  .scan-results-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 16px;
    border-bottom: 1px solid var(--border);
  }
  
  .scan-results-title {
    font-weight: 700;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .scan-result-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid var(--border);
  }
  
  .scan-result-item:last-child {
    border-bottom: none;
  }
  
  .scan-result-label {
    color: var(--muted);
    font-weight: 500;
  }
  
  .scan-result-value {
    font-weight: 600;
    text-align: right;
  }
  
  .scan-result-good {
    color: var(--good);
  }
  
  .scan-result-warning {
    color: var(--warn);
  }
  
  .scan-result-danger {
    color: var(--danger);
  }
  
  .scan-result-actions {
    display: flex;
    gap: 12px;
    margin-top: 24px;
  }
  
  .scan-result-actions .btn-ghost {
    flex: 1;
  }
  
  .scan-result-actions .big-btn {
    flex: 2;
    margin: 0;
  }
  
  /* Status indicator */
  .status-indicator {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    border-radius: 20px;
    font-weight: 600;
    font-size: 0.85rem;
  }
  
  .status-indicator.good {
    background: rgba(40, 167, 69, 0.1);
    color: var(--good);
  }
  
  .status-indicator.warning {
    background: rgba(255, 193, 7, 0.1);
    color: var(--warn);
  }
  
  .status-indicator.danger {
    background: rgba(220, 53, 69, 0.1);
    color: var(--danger);
  }
  
  /* Animal match section */
  .animal-match {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px;
    background: var(--bg-lighter);
    border-radius: 12px;
    margin: 16px 0;
    border: 1px solid var(--border);
  }
  
  .animal-match-info {
    flex: 1;
  }
  
  .animal-match-name {
    font-weight: 700;
    font-size: 1.1rem;
    margin-bottom: 4px;
  }
  
  .match-confidence {
    font-size: 0.85rem;
    color: var(--muted);
  }
  
  /* Toast notification */
  .toast {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%) translateY(-100px);
    background: var(--text-primary);
    color: white;
    padding: 12px 20px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    z-index: 1000;
    opacity: 0;
    transition: all 0.3s ease;
    font-weight: 500;
  }
  
  .toast.show {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
  }
  
  .toast.success {
    background: var(--good);
  }
  
  .toast.error {
    background: var(--danger);
  }
  
  .toast.warning {
    background: var(--warn);
  }
  
  /* Camera mode selector */
  .camera-mode-selector {
    display: flex;
    gap: 8px;
    margin-bottom: 16px;
  }
  
  .mode-btn {
    flex: 1;
    padding: 12px;
    border: 1px solid var(--border);
    background: var(--bg-lighter);
    border-radius: 10px;
    cursor: pointer;
    text-align: center;
    font-weight: 500;
    transition: all 0.2s ease;
  }
  
  .mode-btn.active {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
  }
  
  .mode-btn:hover:not(.active) {
    background: white;
    border-color: var(--accent);
  }
  
  /* Multi-image upload styles */
  .image-upload-container {
    margin: 16px 0;
  }
  
  .uploaded-images-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    margin: 16px 0;
  }
  
  .uploaded-image-item {
    position: relative;
    width: 100%;
    aspect-ratio: 1;
    border-radius: 8px;
    overflow: hidden;
    border: 2px solid var(--border);
  }
  
  .uploaded-image-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .remove-image-btn {
    position: absolute;
    top: 4px;
    right: 4px;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: var(--danger);
    color: white;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    cursor: pointer;
  }
  
  .image-count-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    background: var(--accent);
    color: white;
    border-radius: 50%;
    font-size: 0.8rem;
    font-weight: 600;
    margin-left: 8px;
  }
  
  .upload-instructions {
    background: rgba(91, 146, 121, 0.1);
    border-radius: 10px;
    padding: 12px;
    margin: 12px 0;
    font-size: 0.85rem;
    border-left: 3px solid var(--accent);
  }
  
  .upload-instructions ul {
    margin: 8px 0 8px 16px;
  }
  
  .upload-instructions li {
    margin-bottom: 4px;
  }
  
  .capture-count {
    font-weight: 600;
    color: var(--accent);
    font-size: 1.1rem;
  }
  
  /* File upload area */
  .file-upload-area {
    border: 2px dashed var(--border);
    border-radius: 12px;
    padding: 24px;
    text-align: center;
    margin: 16px 0;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .file-upload-area:hover {
    border-color: var(--accent);
    background: rgba(91, 146, 121, 0.05);
  }
  
  .file-upload-area i {
    font-size: 2rem;
    color: var(--accent);
    margin-bottom: 12px;
  }
  
  /* Video recorder styles */
  .video-recorder {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
  
  .recording-indicator {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--danger);
    font-weight: 600;
    justify-content: center;
    margin-bottom: 16px;
  }
  
  .recording-dot {
    width: 12px;
    height: 12px;
    background-color: var(--danger);
    border-radius: 50%;
    animation: pulse 1.5s infinite;
  }
  
  @keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.3; }
    100% { opacity: 1; }
  }
  
  .video-controls {
    display: flex;
    gap: 12px;
    margin-top: 16px;
  }
  
  .video-controls .btn-ghost {
    flex: 1;
  }
  
  .video-controls .big-btn {
    flex: 2;
    margin: 0;
  }
  
  .video-upload-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    width: 100%;
    padding: 16px;
    background: var(--bg-lighter);
    border: 2px dashed var(--border);
    border-radius: 12px;
    color: var(--muted);
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    margin-top: 16px;
  }
  
  .video-upload-btn:hover {
    border-color: var(--accent);
    background: rgba(91, 146, 121, 0.05);
    color: var(--accent);
  }
  
  .video-upload-btn i {
    font-size: 1.2rem;
  }
  
  /* Video playback */
  #video-playback {
    width: 100%;
    border-radius: 12px;
    margin-bottom: 16px;
    display: none;
    max-height: 250px;
    object-fit: contain;
    background: #000;
  }
  
  .video-submit-btn {
    width: 100%;
    margin-top: 16px;
  }
</style>
</head>
<body>
  <!-- Toast Notification -->
  <div id="toast" class="toast"></div>

  <!-- Splash Screen -->
  <div id="splash-screen">
    <div class="splash-logo">
      <img src="/cow.png" width="40" alt="">
    </div>
    <div class="splash-text">M<span style="color: chocolate;">oo</span>mbe</div>
    <div class="splash-subtext">Intelligent Livestock Management</div>
  </div>

  <!-- Auth Screens -->
  <div id="auth-screen" class="hidden">
    <!-- Login View -->
    <div id="auth-login" class="auth-view">
      <div class="auth-header">
        <div class="auth-logo">
          <img src="/cow.png" width="40" alt="">
        </div>
        <div class="auth-title">Welcome Back</div>
        <div class="auth-subtitle">Sign in to monitor your cattle</div>
      </div>
      
      <div class="auth-card">
        <div class="form-group">
          <label class="form-label">Email Address</label>
          <div class="input-wrapper">
            <i class="ri-mail-line input-icon"></i>
            <input type="email" class="form-input with-icon" id="login-email" placeholder="farmer@example.com">
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Password</label>
          <div class="input-wrapper">
            <i class="ri-lock-line input-icon"></i>
            <input type="password" class="form-input with-icon" id="login-password" placeholder="Enter your password">
          </div>
        </div>
        
        <button class="big-btn" id="btn-login">
          <i class="ri-login-box-line"></i> Sign In
        </button>
        
        <div class="divider">
          <div class="divider-text">or</div>
        </div>
        
        <button class="big-btn" id="btn-google-login" style="background: #4285F4;">
          <i class="ri-google-fill"></i> Continue with Google
        </button>
        
        <div class="divider">
          <div class="divider-text">or</div>
        </div>
        
        <div class="center">
          <button class="btn-ghost" id="btn-go-to-signup">
            <i class="ri-user-add-line"></i> Create New Account
          </button>
        </div>
      </div>
      
      <div class="center">
        <a href="#" class="auth-link" id="btn-forgot-password">
          <i class="ri-key-line"></i> Forgot Password?
        </a>
      </div>
    </div>
    
    <!-- Signup View -->
    <div id="auth-signup" class="auth-view hidden">
      <div class="auth-header">
        <div class="auth-logo">
          <img src="/cow.png" width="40" alt="">
        </div>
        <div class="auth-title">Create Account</div>
        <div class="auth-subtitle">Start monitoring your cattle</div>
      </div>
      
      <div class="auth-card">
        <div class="form-group">
          <label class="form-label">Full Name</label>
          <div class="input-wrapper">
            <i class="ri-user-line input-icon"></i>
            <input type="text" class="form-input with-icon" id="signup-name" placeholder="John Farmer">
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Email Address</label>
          <div class="input-wrapper">
            <i class="ri-mail-line input-icon"></i>
            <input type="email" class="form-input with-icon" id="signup-email" placeholder="farmer@example.com">
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Password</label>
          <div class="input-wrapper">
            <i class="ri-lock-line input-icon"></i>
            <input type="password" class="form-input with-icon" id="signup-password" placeholder="Create a strong password (min. 6 chars)">
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Confirm Password</label>
          <div class="input-wrapper">
            <i class="ri-lock-line input-icon"></i>
            <input type="password" class="form-input with-icon" id="signup-confirm" placeholder="Confirm your password">
          </div>
        </div>
        
        <button class="big-btn" id="btn-signup">
          <i class="ri-user-add-line"></i> Create Account
        </button>
        
        <div class="divider">
          <div class="divider-text">or</div>
        </div>
        
        <button class="big-btn" id="btn-google-signup" style="background: #4285F4;">
          <i class="ri-google-fill"></i> Continue with Google
        </button>
        
        <div class="divider">
          <div class="divider-text">or</div>
        </div>
        
        <div class="center">
          <button class="btn-ghost" id="btn-go-to-login">
            <i class="ri-login-box-line"></i> Already have an account?
          </button>
        </div>
      </div>
    </div>
    
    <!-- Forgot Password View -->
    <div id="auth-forgot" class="auth-view hidden">
      <div class="auth-header">
        <div class="auth-logo">
          <i class="ri-cow-line"></i>
        </div>
        <div class="auth-title">Reset Password</div>
        <div class="auth-subtitle">We'll send you a reset link</div>
      </div>
      
      <div class="auth-card">
        <div class="form-group">
          <label class="form-label">Email Address</label>
          <div class="input-wrapper">
            <i class="ri-mail-line input-icon"></i>
            <input type="email" class="form-input with-icon" id="forgot-email" placeholder="Enter your email">
          </div>
        </div>
        
        <button class="big-btn" id="btn-send-reset">
          <i class="ri-mail-send-line"></i> Send Reset Link
        </button>
        
        <div class="divider">
          <div class="divider-text">or</div>
        </div>
        
        <div class="center">
          <button class="btn-ghost" id="btn-go-to-login-from-forgot">
            <i class="ri-arrow-left-line"></i> Back to Login
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Main App (initially hidden) -->
  <div class="app hidden" id="app">
    <!-- App Header -->
    <header class="app-header">
      <div class="app-header-content">
        <div>
          <h1>M<span style="color: chocolate;">oo</span>mbe</h1>
          
        </div>
        <div class="header-actions">
          <button class="header-btn" id="btn-notifications-header" title="Notifications">
            <i class="ri-notification-3-line"></i>
          </button>
        </div>
      </div>
    </header>

    <!-- Main Content Area -->
    <main class="app-main">
      <!-- DASHBOARD VIEW -->
      <div id="view-dashboard" class="view active">
        <!-- Scan Button at Top -->
        <button class="big-btn scan-top-btn" id="btn-scan-top">
          <i class="ri-camera-3-line"></i> Scan Cattle
        </button>

        <section class="card">
          <div class="stats">
            <div class="stat">
              <div class="muted small">
                <i class="ri-cow-line"></i> Total Cattle
              </div>
              <div id="stat-animals" style="font-weight:700;font-size:1.4rem;margin-top:6px;color:var(--text-primary)">0</div>
            </div>
            <div class="stat">
              <div class="muted small">
                <i class="ri-heart-line"></i> Healthy
              </div>
              <div id="stat-healthy" style="font-weight:700;font-size:1.4rem;margin-top:6px;color:var(--good)">0</div>
            </div>
            <div class="stat">
              <div class="muted small">
                <i class="ri-alert-line"></i> Needs Attention
              </div>
              <div id="stat-sick" style="font-weight:700;font-size:1.4rem;margin-top:6px;color:var(--warn)">0</div>
            </div>
          </div>
          <div class="muted small center" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--border);">
            <i class="ri-information-line"></i> Scan cattle to add them to your herd
          </div>
        </section>

        <section class="card">
          <div class="section-header">
            <div class="section-title">
              <i class="ri-alarm-warning-line"></i> Recent Alerts
            </div>
            <button class="btn-ghost" id="btn-open-alerts">
              <i class="ri-eye-line"></i> View all
            </button>
          </div>
          <div id="alerts-list">
            <div class="muted small" style="text-align:center;padding:20px">No alerts yet. Scan cattle to detect issues.</div>
          </div>
        </section>

        <section class="card">
          <div class="section-header">
            <div class="section-title">
              <i class="ri-cow-line"></i> Your Cattle
            </div>
            <div class="muted small">Tap to view details</div>
          </div>
          <div id="animals-list">
            <div class="muted small" style="text-align:center;padding:30px">
              <i class="ri-camera-line" style="font-size: 2rem; margin-bottom: 10px; display: block; color: var(--muted);"></i>
              No cattle in your herd yet.<br>
              <button class="btn-ghost" style="margin-top: 12px;" id="btn-first-scan">
                <i class="ri-camera-line"></i> Scan Your First Cattle
              </button>
            </div>
          </div>
        </section>
      </div>

      <!-- ANIMAL PROFILE VIEW -->
      <div id="view-animal-profile" class="view">
        <section class="card">
          <div class="profile-header">
            <div>
              <div id="profile-name" style="font-weight:700;font-size:1.3rem;margin-bottom:4px">--</div>
              <div class="muted small" id="profile-tag">--</div>
            </div>
            <div class="avatar" id="profile-avatar">
              <i class="ri-cow-line"></i>
            </div>
          </div>

          <div class="profile-stats">
            <div style="flex:1">
              <div class="muted small">
                <i class="ri-restaurant-line"></i> Last Scan
              </div>
              <div id="profile-lastfeed" style="font-weight:600;margin-top:4px">--</div>
            </div>
            <div style="flex:1">
              <div class="muted small">
                <i class="ri-heart-line"></i> Health
              </div>
              <div id="profile-health" style="font-weight:600;margin-top:4px" class="status-healthy">--</div>
            </div>
          </div>

          <div class="mt8">
            <button class="big-btn" id="profile-scan">
              <i class="ri-camera-line"></i> Scan This Cattle Again
            </button>
            <button class="big-btn" id="profile-history">
              <i class="ri-history-line"></i> View Health History
            </button>
          </div>
        </section>

        <section class="card">
          <div class="section-title" style="margin-bottom:12px">
            <i class="ri-alarm-warning-line"></i> Health Alerts
          </div>
          <div id="profile-alerts">
            <div class="muted small" style="text-align:center;padding:20px">No alerts for this cattle</div>
          </div>
        </section>

        <div style="margin-top:12px">
          <button class="btn-ghost" id="back-to-dashboard">
            <i class="ri-arrow-left-line"></i> Back to Dashboard
          </button>
        </div>
      </div>

      <!-- ALERTS VIEW -->
      <div id="view-alerts" class="view">
        <section class="card">
          <div class="section-header">
            <div class="section-title">
              <i class="ri-alarm-warning-line"></i> All Alerts
            </div>
            <div class="chip" id="alerts-count">0</div>
          </div>
          <div id="alerts-all">
            <div class="muted small" style="text-align:center;padding:30px">No alerts in the system</div>
          </div>
        </section>
        <div style="margin-top:12px">
          <button class="btn-ghost" id="alerts-back">
            <i class="ri-arrow-left-line"></i> Back to Dashboard
          </button>
        </div>
      </div>

      <!-- USER PROFILE VIEW -->
      <div id="view-user-profile" class="view">
        <section class="card">
          <div class="center">
            <div class="profile-avatar-large">
              <i class="ri-user-line"></i>
            </div>
            <h2 id="user-profile-name" style="margin-bottom: 4px;">John Farmer</h2>
            <div class="muted small" id="user-profile-email">farmer@example.com</div>
          </div>
          
          <div class="profile-section">
            <div class="section-title" style="margin-bottom: 16px;">
              <i class="ri-information-line"></i> Account Information
            </div>
            
            <div class="profile-item">
              <div class="profile-label">Account Type</div>
              <div class="profile-value">Premium Farmer</div>
            </div>
            
            <div class="profile-item">
              <div class="profile-label">Member Since</div>
              <div class="profile-value" id="user-member-since">2024</div>
            </div>
            
            <div class="profile-item">
              <div class="profile-label">Total Cattle</div>
              <div class="profile-value" id="user-total-cattle">0</div>
            </div>
            
            <div class="profile-item">
              <div class="profile-label">Active Alerts</div>
              <div class="profile-value" id="user-active-alerts">0</div>
            </div>
          </div>
          
          <div class="profile-section">
            <div class="section-title" style="margin-bottom: 16px;">
              <i class="ri-settings-3-line"></i> Settings
            </div>
            
            <div class="profile-item" style="cursor: pointer;" id="btn-notifications">
              <div>
                <div style="font-weight: 500;">Notifications</div>
                <div class="muted small">Manage alert preferences</div>
              </div>
              <i class="ri-arrow-right-s-line"></i>
            </div>
            
            <div class="profile-item" style="cursor: pointer;" id="btn-cattle-management">
              <div>
                <div style="font-weight: 500;">Cattle Management</div>
                <div class="muted small">Add/remove cattle, edit details</div>
              </div>
              <i class="ri-arrow-right-s-line"></i>
            </div>
            
            <div class="profile-item" style="cursor: pointer;" id="btn-privacy">
              <div>
                <div style="font-weight: 500;">Privacy & Data</div>
                <div class="muted small">Data usage and privacy settings</div>
              </div>
              <i class="ri-arrow-right-s-line"></i>
            </div>
          </div>
          
          <div class="danger-zone">
            <div class="section-title" style="color: var(--danger); margin-bottom: 16px;">
              <i class="ri-alert-line"></i> Account Actions
            </div>
            
            <div class="info-note">
              <strong><i class="ri-camera-video-line"></i> Video Capture Note:</strong><br>
              You can capture videos or upload existing videos of your cattle for more detailed health analysis. Videos can help detect movement patterns and behavioral issues.
            </div>
            
            <button class="big-btn" id="btn-change-password" style="background: var(--bg-lighter); color: var(--text-primary);">
              <i class="ri-key-line"></i> Change Password
            </button>
            
            <button class="big-btn logout" id="btn-logout-profile" style="background: var(--danger); margin-top: 12px;">
              <i class="ri-logout-box-r-line"></i> Log Out
            </button>
            
            <div class="muted small" style="text-align: center; margin-top: 16px;">
              Version 1.0.0 • Moombe Livestock AI
            </div>
          </div>
        </section>
        
        <div style="margin-top:12px">
          <button class="btn-ghost" id="user-profile-back">
            <i class="ri-arrow-left-line"></i> Back to Dashboard
          </button>
        </div>
      </div>
    </main>

    <!-- FOOTER NAV -->
    <footer class="app-footer">
      <button class="nav-btn active" data-view="dashboard" id="nav-dashboard">
        <i class="ri-home-4-line nav-icon"></i>
        <span class="nav-label">Home</span>
      </button>
      <button class="nav-btn" data-view="alerts" id="nav-alerts">
        <i class="ri-alarm-warning-line nav-icon"></i>
        <span class="nav-label">Alerts</span>
      </button>
      <button class="nav-btn" data-view="user-profile" id="nav-user-profile">
        <i class="ri-user-line nav-icon"></i>
        <span class="nav-label">Profile</span>
      </button>
    </footer>
  </div>

  <!-- CAMERA MODAL -->
  <div id="modal-camera" class="modal-backdrop hidden" aria-hidden="true">
    <div class="modal">
      <div class="section-header" style="margin-bottom:16px">
        <strong style="font-size:1.1rem">
          <i class="ri-camera-line"></i> Scan Cattle
        </strong>
        <button class="btn-ghost" id="modal-camera-close">
          <i class="ri-close-line"></i> Close
        </button>
      </div>
      
      <div class="camera-mode-selector">
        <button class="mode-btn active" id="mode-photo">
          <i class="ri-camera-line"></i> Photo
          <span class="image-count-badge" id="photo-count">0</span>
        </button>
        <button class="mode-btn" id="mode-video">
          <i class="ri-video-line"></i> Video
        </button>
      </div>
      
      <div class="center">
        <!-- Photo Mode Content -->
        <div id="photo-mode-content">
          <video id="photo-camera-preview" autoplay playsinline style="display:none; width:100%; border-radius: 12px; margin-bottom: 12px; background: #000;"></video>
          <div class="upload-instructions">
            <strong>For best analysis:</strong>
            <ul>
              <li>Upload <span class="capture-count">3 or more</span> photos of the same cattle</li>
              <li>Include different angles (side, front, back)</li>
              <li>Ensure good lighting</li>
              <li>Capture any visible wounds or issues</li>
            </ul>
          </div>
          
          <div class="uploaded-images-grid" id="uploaded-images-grid">
            <!-- Images will be added here -->
          </div>
          
          <div class="file-upload-area" id="file-upload-area">
            <i class="ri-folder-upload-line"></i>
            <div style="font-weight: 600; margin-bottom: 8px;">Upload Photos</div>
            <div class="muted small">Click to select or drag & drop images</div>
            <div class="muted text-xs" style="margin-top: 8px;">
              <i class="ri-information-line"></i> Minimum 3 photos required
            </div>
          </div>
          
          <input type="file" accept="image/*" id="camera-file-input" multiple>
          <div class="muted small mb8" id="photo-instruction">
            <span id="photos-count-text">0 photos uploaded</span> • Need at least 3 photos
          </div>

          <div class="camera-actions">
            <button class="btn-ghost" id="btn-upload-more">
              <i class="ri-folder-upload-line"></i> Upload More
            </button>
            <button class="btn-ghost" id="btn-take-photo" disabled>
              <i class="ri-camera-line"></i> Take Photo
            </button>
            <button class="big-btn" id="btn-analyze-photos" disabled style="opacity: 0.6;">
              <i class="ri-search-eye-line"></i> Analyze Photos
            </button>
          </div>
        </div>
        
        <!-- Video Mode Content -->
        <div id="video-mode-content" class="hidden">
          <video id="camera-video" autoplay playsinline></video>
          <video id="video-playback" controls style="display: none; width: 100%; border-radius: 12px; margin-bottom: 16px;"></video>
          
          <div class="recording-indicator hidden" id="recording-indicator">
            <div class="recording-dot"></div>
            <span>Recording video...</span>
          </div>
          
          <div class="muted small mb8" id="video-instruction">
            Record a video or upload existing video of cattle for movement analysis
          </div>
          
          <!-- Video Upload Button -->
          <div class="video-upload-btn" id="video-upload-btn">
            <i class="ri-folder-upload-line"></i>
            <span>Upload Video File</span>
          </div>
          <input type="file" accept="video/*" id="video-file-input" class="hidden">
          
          <div class="video-controls">
            <button class="btn-ghost" id="video-record-btn">
              <i class="ri-record-circle-line"></i> Start Recording
            </button>
            <button class="big-btn" id="video-stop-btn" style="display: none;">
              <i class="ri-stop-circle-line"></i> Stop Recording
            </button>
          </div>
          
          <button class="big-btn video-submit-btn" id="video-submit-btn" disabled style="opacity: 0.6;">
            <i class="ri-search-eye-line"></i> Submit Video for Scan
          </button>
        </div>
        
        <div class="progress"><i id="scan-progress"></i></div>
        
        <div class="muted small mt8" id="scan-status">
          Ready to scan
        </div>
      </div>
    </div>
  </div>

  <!-- SCAN RESULTS MODAL -->
  <div id="modal-results" class="modal-backdrop hidden" aria-hidden="true">
    <div class="modal">
      <div class="scan-results-header">
        <div class="scan-results-title">
          <i class="ri-search-eye-line"></i> Scan Results
        </div>
        <button class="btn-ghost" id="modal-results-close" style="padding: 8px 12px;">
          <i class="ri-close-line"></i> Close
        </button>
      </div>
      
      <div id="scan-results-content">
        <!-- Results will be populated here -->
      </div>
      
      <div class="scan-result-actions">
        <button class="btn-ghost" id="results-scan-other">
          <i class="ri-camera-line"></i> Scan Another
        </button>
        <button class="big-btn" id="results-view-profile">
          <i class="ri-cow-line"></i> View Cattle Profile
        </button>
      </div>
    </div>
  </div>

<script>
/* Mock AI analysis for multiple photos - MODIFIED FOR UNLIMITED SCANS */
function mockMultiPhotoAIAnalyze(photos) {
  const photoCount = photos.length;
  
  // Cattle names for realistic identification
  const cattleNames = ["Bessie", "Daisy", "Molly", "Clara", "Rosie", "Bella", "Maggie", "Buttercup", "Coco", "Luna"];
  const breeds = ["Holstein", "Jersey", "Angus", "Hereford", "Brahman", "Simmental", "Charolais", "Limousin", "Texas Longhorn"];
  
  // Track scan count for this session only (not for limiting)
  const sessionScanCount = STATE.animals.length;
  
  // For first animal scan: always find a sick cow
  let isNewAnimal = false;
  let matchedAnimal = null;
  
  // Check if this is the VERY FIRST SCAN EVER (no animals in herd)
  if (STATE.animals.length === 0) {
    // First scan: always create a new sick animal
    isNewAnimal = true;
  } else {
    // For subsequent scans: 70% chance to match existing, 30% chance new
    isNewAnimal = Math.random() < 0.3;
    
    // If not new, pick a random existing animal
    if (!isNewAnimal && STATE.animals.length > 0) {
      matchedAnimal = STATE.animals[Math.floor(Math.random() * STATE.animals.length)];
    }
  }
  
  // HEALTH PROGRESSION LOGIC:
  // First animal (no matter which scan number) is sick
  // For existing animals, random health status (with some logic)
  let overallHealth = "Good";
  let issueType = null;
  let recommendations = [];
  
  if (isNewAnimal) {
    // New animals: 80% chance sick, 20% chance healthy
    const isSick = Math.random() < 0.8;
    
    if (isSick) {
      overallHealth = Math.random() < 0.5 ? "Critical" : "Warning";
      
      if (overallHealth === "Critical") {
        issueType = "Fever & Loss of Appetite";
        recommendations = [
          "Administer antibiotic injection (Penicillin 20,000 IU/kg IM)",
          "Provide electrolyte solution in drinking water",
          "Isolate from herd for 3 days",
          "Monitor temperature twice daily"
        ];
      } else {
        issueType = "Mild Respiratory Infection";
        recommendations = [
          "Administer anti-inflammatory medication",
          "Ensure dry and warm shelter",
          "Monitor eating habits for 48 hours",
          "Provide vitamin supplements"
        ];
      }
    } else {
      overallHealth = "Good";
      issueType = null;
      recommendations = ["No treatment needed", "Continue regular health checks"];
    }
  } else if (matchedAnimal) {
    // Existing animal: check current health and possibly change it
    const healthChangeChance = 0.3; // 30% chance health changes
    
    if (matchedAnimal.health_status === "Critical") {
      if (Math.random() < 0.6) {
        // 60% chance of improvement from Critical
        overallHealth = "Warning";
        issueType = "Recovering but weak";
        recommendations = [
          "Continue antibiotic course for 2 more days",
          "Add vitamin B complex to feed",
          "Provide warm shelter",
          "Offer high-energy feed supplements"
        ];
      } else {
        // 40% chance remains critical
        overallHealth = "Critical";
        issueType = "Fever & Loss of Appetite";
        recommendations = [
          "Administer antibiotic injection (Penicillin 20,000 IU/kg IM)",
          "Provide electrolyte solution in drinking water",
          "Isolate from herd for 3 days",
          "Monitor temperature twice daily"
        ];
      }
    } else if (matchedAnimal.health_status === "Warning") {
      if (Math.random() < 0.7) {
        // 70% chance of improvement from Warning
        overallHealth = "Good";
        issueType = null;
        recommendations = ["Continue monitoring for 1 week", "Gradually reintroduce to herd"];
      } else if (Math.random() < 0.5) {
        // 15% chance worsens to Critical
        overallHealth = "Critical";
        issueType = "Condition worsened";
        recommendations = [
          "Administer stronger antibiotics",
          "Consult veterinarian immediately",
          "Complete isolation required",
          "IV fluids may be necessary"
        ];
      } else {
        // 15% chance stays Warning
        overallHealth = "Warning";
        issueType = "Still recovering";
        recommendations = [
          "Continue current treatment",
          "Monitor closely for changes",
          "Provide extra bedding"
        ];
      }
    } else {
      // Currently healthy
      if (Math.random() < healthChangeChance) {
        // Chance to become sick
        overallHealth = Math.random() < 0.3 ? "Critical" : "Warning";
        
        if (overallHealth === "Critical") {
          issueType = "Sudden illness detected";
          recommendations = [
            "Immediate veterinary attention required",
            "Isolate from other cattle",
            "Monitor vital signs hourly"
          ];
        } else {
          issueType = "Early signs of illness";
          recommendations = [
            "Administer preventive medication",
            "Increase monitoring frequency",
            "Check herd for similar symptoms"
          ];
        }
      } else {
        overallHealth = "Good";
        issueType = null;
        recommendations = ["No treatment needed", "Continue regular health checks"];
      }
    }
  }
  
  // Generate results
  const breed = breeds[Math.floor(Math.random() * breeds.length)];
  const confidence = 0.7 + (photoCount * 0.05) + (matchedAnimal ? 0.1 : 0);
  
  return {
    is_new_animal: isNewAnimal,
    matched_animal: matchedAnimal,
    issue_detected: issueType !== null,
    issue_type: issueType,
    recommendations: recommendations,
    confidence: Math.min(confidence, 0.95).toFixed(2),
    breed_detected: breed,
    overall_health: overallHealth,
    movement_score: overallHealth === "Critical" ? "Lethargic" : (overallHealth === "Warning" ? "Slow" : "Active"),
    photos_analyzed: photoCount,
    analysis_notes: `Analyzed ${photoCount} photos. ${isNewAnimal ? "New cattle detected." : "Matched existing cattle."}`,
    suggested_name: cattleNames[Math.floor(Math.random() * cattleNames.length)],
    tag_number: `QR-${String(STATE.animals.length + 1).padStart(3, '0')}`
  };
}

/* Mock video analysis - MODIFIED FOR UNLIMITED SCANS */
function mockVideoAIAnalyze(videoBlob) {
  // Similar logic to photo analysis
  const cattleNames = ["Bessie", "Daisy", "Molly", "Clara", "Rosie"];
  const breeds = ["Holstein", "Jersey", "Angus", "Hereford"];
  
  // Check if this is the first scan ever
  let isNewAnimal = STATE.animals.length === 0;
  let matchedAnimal = null;
  
  if (!isNewAnimal) {
    // 70% chance to match existing, 30% new
    isNewAnimal = Math.random() < 0.3;
    
    if (!isNewAnimal && STATE.animals.length > 0) {
      matchedAnimal = STATE.animals[Math.floor(Math.random() * STATE.animals.length)];
    }
  }
  
  // Health logic (similar to photo version)
  let overallHealth = "Good";
  let issueType = null;
  let recommendations = [];
  
  if (isNewAnimal) {
    // New animals from video: similar chance of sickness
    const isSick = Math.random() < 0.7;
    
    if (isSick) {
      overallHealth = Math.random() < 0.6 ? "Critical" : "Warning";
      
      if (overallHealth === "Critical") {
        issueType = "Fever & Lameness";
        recommendations = [
          "Administer anti-inflammatory (Flunixin 2.2 mg/kg IV)",
          "Apply cold compress to affected leg",
          "Restrict movement for 48 hours",
          "Provide soft bedding"
        ];
      } else {
        issueType = "Slight limp detected";
        recommendations = [
          "Monitor walking pattern",
          "Check for hoof issues",
          "Provide softer ground surface"
        ];
      }
    } else {
      overallHealth = "Good";
      issueType = null;
      recommendations = ["Normal movement observed", "Continue regular checks"];
    }
  } else if (matchedAnimal) {
    // Existing animal health logic
    const healthChangeChance = 0.25;
    
    if (matchedAnimal.health_status === "Critical") {
      if (Math.random() < 0.5) {
        overallHealth = "Warning";
        issueType = "Improving but still limping";
        recommendations = [
          "Continue anti-inflammatory treatment",
          "Gentle exercise twice daily",
          "Monitor walking pattern"
        ];
      } else {
        overallHealth = "Critical";
        issueType = "Severe lameness persists";
        recommendations = [
          "Veterinary consultation required",
          "Complete stall rest",
          "Pain management medication"
        ];
      }
    } else if (matchedAnimal.health_status === "Warning") {
      if (Math.random() < 0.6) {
        overallHealth = "Good";
        issueType = null;
        recommendations = ["Movement improving", "Continue light exercise"];
      } else {
        overallHealth = "Warning";
        issueType = "Gait still abnormal";
        recommendations = [
          "Continue monitoring",
          "Check for joint swelling",
          "Consider x-ray if no improvement"
        ];
      }
    } else {
      // Currently healthy
      if (Math.random() < healthChangeChance) {
        overallHealth = Math.random() < 0.4 ? "Critical" : "Warning";
        issueType = overallHealth === "Critical" ? "Sudden lameness" : "Slight gait abnormality";
        recommendations = [
          "Restrict movement",
          "Check for injuries",
          "Monitor closely"
        ];
      } else {
        overallHealth = "Good";
        issueType = null;
        recommendations = ["Normal movement", "Continue regular exercise"];
      }
    }
  }
  
  // Video-specific analysis
  const movementScore = overallHealth === "Critical" ? "Severely impaired" : 
                       (overallHealth === "Warning" ? "Slightly impaired" : "Normal");
  
  const behaviorAnalysis = overallHealth === "Critical" ? "Visible discomfort while walking" : 
                          (overallHealth === "Warning" ? "Slight gait abnormality" : "Normal gait pattern");
  
  return {
    is_new_animal: isNewAnimal,
    matched_animal: matchedAnimal,
    issue_detected: issueType !== null,
    issue_type: issueType,
    recommendations: recommendations,
    confidence: (0.75 + Math.random() * 0.2).toFixed(2),
    breed_detected: breeds[Math.floor(Math.random() * breeds.length)],
    overall_health: overallHealth,
    movement_score: movementScore,
    behavior_analysis: behaviorAnalysis,
    video_duration: `${Math.floor(Math.random() * 30) + 10} seconds`,
    motion_patterns: movementScore === "Normal" ? "Smooth movement" : "Irregular gait detected",
    analysis_method: "Video motion analysis",
    suggested_name: cattleNames[Math.floor(Math.random() * cattleNames.length)],
    tag_number: `QR-${String(STATE.animals.length + 1).padStart(3, '0')}`
  };
}

</script>
</body>
</html>
